services:
  etcd:
    image: "${REGISTRY}:${ETCD_VERSION}"
    # Hardcoded container name
    container_name: etcd
    restart: unless-stopped
    ports:
      - "2379:2379"
      - "2380:2380"
    volumes:
      - "${DATA_DIR}:/etcd-data"
    environment:
      THIS_NAME: "${NAME_1}"
      THIS_IP: "${HOST_1}"
      CLUSTER: "${CLUSTER}"
      CLUSTER_STATE: "${CLUSTER_STATE}"
      TOKEN: "${TOKEN}"
    command:
      - /bin/sh
      - -c
      - >
          /usr/local/bin/etcd
          --data-dir=/etcd-data
          --name ${THIS_NAME}
          --initial-advertise-peer-urls http://${THIS_IP}:2380
          --listen-peer-urls http://0.0.0.0:2380
          --advertise-client-urls http://${THIS_IP}:2379
          --listen-client-urls http://0.0.0.0:2379
          --initial-cluster ${CLUSTER}
          --initial-cluster-state ${CLUSTER_STATE}
          --initial-cluster-token ${TOKEN}
