services:
  # CA Server - Run only on Node 1
  multirootca:
    image: cfssl/cfssl:latest
    container_name: multirootca
    restart: unless-stopped
    ports:
      - "8888:8888"
    volumes:
      - "${PKI_DIR}:/pki"
    command:
      - serve
      - -address=0.0.0.0
      - -port=8888
      - -ca=/pki/intermediate-ca.pem
      - -ca-key=/pki/intermediate-ca-key.pem
      - -config=/pki/ca-config.json
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8888/api/v1/cfssl/info"]
      interval: 30s
      timeout: 10s
      retries: 3
